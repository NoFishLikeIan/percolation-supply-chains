\documentclass[draft, american, abstract=on]{scrartcl}

    \newcommand{\lang}{en}

    \usepackage{babel}
    \usepackage[utf8]{inputenc}

    \usepackage{csquotes}

    \usepackage{ifdraft}

    \usepackage{amsmath, amssymb, mathtools, bbm}
    \usepackage{amsthm}
    \usepackage{xcolor}
    \usepackage{xcolor-solarized}
    \usepackage{bm}

    \usepackage{graphicx}
    \usepackage{wrapfig}
    \usepackage{relsize}
    \usepackage{makecell}
    \usepackage{booktabs}
    \usepackage[font=footnotesize,labelfont=bf]{caption}
    \usepackage{subcaption}
    \usepackage{float}
    \usepackage{multirow} 
    \usepackage{hyperref}
    \usepackage{bookmark}
    
    % Diagrams
    \usepackage{tikz} 
    \usepackage{tikzit}
    \usetikzlibrary{positioning,fit,calc,decorations.pathreplacing,calligraphy}
    \input{../diagrams/percolation.tikzstyles}
    \input{../diagrams/diagram.tikzstyles}
    \input{../diagrams/custom.tikzstyles}

    \newcommand{\inputTikZ}[2]{%  

      \ifdraft{
        \includegraphics[width=0.5\textwidth]{example-image-a}
      }{
        \IfFileExists{#2}{\scalebox{#1}{\input{#2}}}{\includegraphics[width=0.5\textwidth]{example-image-a}}
      }
    }
    
    % Refs
    \usepackage{hyperref}
    \usepackage{cleveref}
    \hypersetup{
        colorlinks = true, 
        urlcolor = blue,
        linkcolor = blue, 
        citecolor = blue 
      }      

    \usepackage{subfiles} % Load last

    % Theorems
    \theoremstyle{plain}
    \newtheorem{lemma}{Lemma}
    \newtheorem{definition}{Definition}
    \newtheorem{statement}{Statement}
    \newtheorem{theorem}{Theorem}

    % Paths

    % Formatting
    \setlength{\parindent}{0em}
    \setlength{\parskip}{0.5em}
    \setlength{\fboxsep}{1em}
    \newcommand\headercell[1]{\smash[b]{\begin{tabular}[t]{@{}c@{}} #1 \end{tabular}}}

    % Graphs

    % Math commands

    \newcommand{\diff}{\text{d}}
    \renewcommand{\Re}{\mathbb{R}}
    \newcommand{\C}{\mathcal{C}}
    \newcommand{\F}{\mathcal{F}}
    \newcommand{\X}{\mathcal{X}}
    \newcommand{\G}{\mathcal{G}}
    \newcommand{\I}{\mathcal{I}}
    \newcommand{\N}{\mathcal{N}}
    \newcommand{\PF}{\mathcal{P} \F}

    \renewcommand{\P}{\mathbb{P}}
    \newcommand{\E}{\mathbb{E}}
    \newcommand{\V}{\mathbb{V}}

    \newcommand{\uI}[2][s]{\int^1_0 #2 \ \text{d} #1}
    \newcommand{\uH}[2][s]{\int^\frac{1}{2}_0 #2 \ \text{d} #1}
    \newcommand{\uF}[2][s]{\int^1_\frac{1}{2} #2 \ \text{d} #1}
    \newcommand{\norm}[1]{\left\lVert#1\right\rVert}
    \newcommand{\abs}[1]{\left\lvert#1\right\rvert}

    \newcommand{\Beta}{\text{Beta}}
    \newcommand{\Bin}{\text{Bin}}

    \DeclarePairedDelimiter\ceil{\lceil}{\rceil}
  \DeclarePairedDelimiter\floor{\lfloor}{\rfloor}

    % Bibliography

    \usepackage[bibencoding=utf8, style=apa, backend=biber]{biblatex}
    \addbibresource{../supply-chain-reallocation.bib}

    \newcommand{\citein}[1]{\citeauthor{#1} (\citeyear{#1})}

    \newcommand\notes[1]{\textcolor{teal}{\footnotesize \textbf{#1}}}

    % Make title page

    \author{Andrea Titton}
    \title{Firms' Sourcing Decisions and\\ Production Network Fragility}
    
\begin{document}

\maketitle
\section{Introduction}

\notes{
  \begin{enumerate}
    \item Research question
    \item Contribution to the literature
    \item Why do we care?
  \end{enumerate}
}


\newpage
\section{Model}

In this section I will introduce a stylised production game of suppliers' risk diversification, in the spirit of the one developed by \citein{elliott_supply_2022}. The model, despite its simplicity, captures the interactions between firms’ decisions and suppliers’ correlation risks. I show how the correlation in suppliers’ risk, on top of directly introducing substantial tail risk, disincentivises firm risk diversification, even when the firms are risk neutral. Strikingly, the interaction between suppliers’ risk correlation and firms’ decision can introduce fragility in a production network even if risk is kept constant.

\subsection{Setup}

Consider a vertical economy producing $K + 1$ goods (as displayed in Figure \ref{fig:vertical-economy-diagram}), indexed by $k \in [K]$\footnote{
  Here I let \begin{equation}[n] \coloneqq \{0, 1, 2, \ldots n \}\end{equation}
}. Each firm produces a single good and each good is produced by $m$ firms. Good $k$ requires only good $k - 1$ as input, hence I will refer to them as good or layers interchangible \notes{(be more clear)}. Each firm picks a set of suppliers in the previous layer to source from. Establishing a relation with a supplier has a fixed cost $\kappa$. If no supplier is able to deliver the input good then the firm is not ``functional'' and hence not able to deliver downstream. I assume that being functional yields an exogenous payoff $\pi$. This assumption will be relaxed later by introducing market structure to endogenise $\pi$, but this does not change the main model mechanics. Finally, we assume that firms know the structure of the economy but do not observe the realised supplier relationship in upstream layers. The only source of risk in the model is an idiosyncratic probability $\mu$ that firms in layer $0$, which require no inputs, are not able to carry on production.

\begin{figure}[H]
  \centering
  \inputTikZ{0.5}{../diagrams/model-presentation.tikz} 
  \caption{$K$-layers vertical economy}
  \label{fig:vertical-economy-diagram}
\end{figure}

A firm is identified by a tuple $(k, i)$, where $i \in [m]$ is an index and $k \in [K]$ is its layer. Then, let $\mathcal{F}_k$ be the set of functioning firms in layer $k$ and $\mathcal{S}_{k, i}$ the set of suppliers of firm $i$. Then, the probability that firm $i$ is functioning is

\begin{equation} \label{eq:functional_probability}
  p_{k, i} \coloneqq \P\big( i \in \mathcal{F}_k \big) = 1 - \P\big( {F}_{k - 1} \cap \mathcal{S}_{k, i} = \emptyset \big),
\end{equation}

since ${F}_{k - 1} \cap \mathcal{S}_{k, i} = \emptyset$ implies that no suppliers of firm $i$ are functional.

\subsection{Firm Problem}

Using equation (\ref{eq:functional_probability}), we can write the problem of the firm as 

\begin{equation}
  \max_{
    \mathcal{S}_{k, i} \subseteq [m]
  } \pi \left(1 - \P\big( {F}_{k - 1} \cap \mathcal{S}_{k, i}\big) = \emptyset \right) - \kappa \abs{\mathcal{S}_{k, i} }.
\end{equation}


To model supply chain uncertainty, we assume that a firm cannot observe, before making its supplier decision, the supplier decisions of the firms producing the necessary input good. This implies that a rational firm producing good $k$ will \notes{(will or can?)} infer the distribution of the number of functioning firms in the previous layer, $F_{k - 1} \coloneqq \abs{\mathcal{F}_{k - 1}}$, based on this, select the optimal number of firms from which to supply, $s_{k, i} = \abs{\mathcal{S}_{k, i}}$, and then pick its suppliers at random. The mixed strategy arises since all potential suppliers producing good $k - 1$ are ex-ante equal. This implies that each firm in layer $k$ might pick a different set of suppliers, but they will all pick the same number of suppliers:

\begin{equation}
  \mathcal{S}_{k, i} \not\equiv \mathcal{S}_{k, j} \text{ but } s_{k, i} = s_{k, j} \eqqcolon s_k.
\end{equation}

Hence, the probability of being functional of firm $i$, $p_{k, i}$, will not necessarily equal that of firm $j$, $p_{j, i}$ but they will be sampled from the same distribution. We can characterise this distribution by looking at the number of possible ways in which, given two random sets $\mathcal{S}_{k, i}$ and $\mathcal{F}_{k - 1}$, the overlap between them will be empty. This quantity will only depend on the sizes of the two sets $s_k$ and $F_{k-1}$. Let $P_m: [m]\times[m]\to[0, 1]$ be such that $1 - P_m(s_k, F_{k - 1})$ is the probability of the two sets not overlapping (i.e. of a firm in $k$ not functioning). This can be written as 

\begin{equation}
  P_m(s_k, F_{k-1}) \coloneqq 1 - \overbrace{\binom{m - s_k}{F_{k-1}}}^{\substack{\text{non-overlapping} \\ \text{configurations}}} \Bigg/ \underbrace{\binom{m}{F_{k-1}}}_{\substack{\text{all possible} \\ \text{configurations}}}.
\end{equation}

Given that the both $\mathcal{S}_{k, i}$ and $\mathcal{F}_{k - 1}$ are random sets, $P_m(s_k, F_{k-1})$ is a random variable and, for all firms $i$ in layer $k$,

\begin{equation}
  p_{k, i} \text{ draw from } P_m(s_k, F_{k-1}).
\end{equation}

We can now make a claim regarding the distribution of $P_m$ and its relationship with that of $F_{k - 1}$. We will see that two distributions will play a key role: the Beta$(\alpha, \beta)$ and the BetaBin($m, \alpha, \beta$). It is more intuitive, in the context of this model, to use an alternative parametrisation of the two distributions. I will hence write $\Beta(1 - \mu, \rho)$ and $\Beta\Bin(m, 1 - \mu, \rho)$ where $\mu = \frac{\beta}{\alpha + \beta}$ and $\rho = \frac{1}{\alpha + \beta + 1}$.

\begin{lemma} \label{lemma:Ftop}
  If $F_k$ is any r.v. taking values in $[m]$, then \begin{equation*}P(s_k, F_{k - 1}) \coloneqq \lim_{m \rightarrow \infty} P_m(s_k, F_{k - 1}) \sim \Beta(1 - \mu_k, \rho_k).\end{equation*} for some $\mu_k$ and $\rho_k$.
\end{lemma}



\begin{statement} \label{statement:ptoF}
  If $P \sim \Beta(1 - \mu_k, \rho_k)$ and $F_k \sim \Bin\big(m, P \big)$, then by definition $F_k \sim \Beta\Bin(m, 1 - \mu_k, \rho_k)$, with,

  \begin{equation} \label{eq:mean_of_F}
    \E \big[F_k\big] = m \E \big[P_k\big] = m (1 - \mu_k)
  \end{equation}

  and 

  \begin{equation} \label{eq:var_of_F}
    \V \big[F_k\big] = m \mu_k (1 - \mu_k) \big(1 + (m - 1) \rho_k\big),
  \end{equation}

  such that $F_k$ ``inherits'' its parameters from $P$.
\end{statement}


Lemma \ref*{lemma:Ftop} and Statement \ref*{statement:ptoF} combine into a powerful result: for large enough $m$ the number of firms that are able to operate at each stage of the production network, $\{F_k\}^{K}_{k = 0}$, follow the same distribution. Such distributions are fully determined by the initial one, $F_0$, and the supplier choice in each layer, $\{s_k\}^{K}_{k = 0}$. Furthermore, for the agent to solve its maximisation problem, hence pick a number of suppliers $s_k$, it is sufficient to infer the distributioon over the number of functioning firms among its potential suppliers, $F_{k - 1}$. Hence, to track the propagation of risk throughout the supply chain, we can simply look at the of evolution of the two parameters $\mu_k$ and $\rho_k$ through the economy.

\subsubsection{Interpretation of the Parameters}

\notes{TODO: Introduce relationship with Bayesian statistics}

It is useful at this point to give an interpretation of $\mu$ and $\rho$, in the context of our model. Looking back at the relationship between the moments of $F$ and these parameters (equations \ref{eq:mean_of_F} and \ref{eq:var_of_F}), we can see that $\mu$ is the fraction of firms that are expected to not deliver. Herafter, I will hence refer to $\mu$ as \textit{risk}. A more subtle role is played by $\rho$. Particularly, this parameter tracks the degree of correlation in the risk of the firms operating in layer $k$. If $\rho 
\to 0$, then firms' risk is independent, $P$ concentrates at $1 - \mu$, and $F$ degenerates into a binomial distribution. On the contrary, if $\rho \rightarrow 1$ then firms' risk is perfectly correlated, $P$ will concentrate at $0$ or $1$, and $F$ will be either 0, with probability $\mu$ and $m$ with probability $1 - \mu$.



\begin{figure}[H]
  \centering
  \begin{subfigure}{.5\textwidth}
    \centering
    \includegraphics[width = \linewidth]{../plots/beta-cdf.png}
    \caption{C.d.f. of $P$ for different values of $\rho$}
    \label{fig:distribution-illustration:beta}
  \end{subfigure}%
  \begin{subfigure}{.5\textwidth}
    \centering
    \includegraphics[width = \linewidth]{../plots/betabin-pdf.png} 
    \caption{P.m.f. of $F$ for different values of $\rho$}
    \label{fig:distribution-illustration:beta-binomial}
  \end{subfigure}%
  \caption{The two figures show the effect of increasing $\rho$ on the distribution of $P$ and hence of $F$.}
  \label{fig:distribution-illustration}
\end{figure}

\subsubsection{Dynamics of Risk}

As argued above. We are interested in the evolution of $\mu_k$ and $\rho_k$ across layers. Let $G: [0, 1]^2 \times [m] \to [0, 1]^2$ be such that

\begin{equation}
  (\mu_k, \rho_k) = G(\mu_{k - 1}, \rho_{k - 1}; \ s_k).
\end{equation}

For convenience, let $G_{\mu}$ and $G_{\rho}$ be the first and second component of $G$ respectively. Then we can write (see Appendix \ref{appendix:derivations} for derivation) the evolution of risk as

\begin{equation} \label{eq:G_mu}
  G_\mu(\mu, \rho, s) = \frac{\left( \mu \  \frac{1 - \rho}{\rho} \right)^{(s)}}{\left( \frac{1 - \rho}{\rho} \right)^{(s)}} = \prod^{s - 1}_{n = 0} \frac{\mu + n \frac{\rho}{1 - \rho}}{1 + n \frac{\rho}{1 - \rho}}
\end{equation}

where $x^{(s)}$ is the rising factorial $x \ (x + 1) \ \ldots \ (x + s - 1)$. The expansion in equation (\ref{eq:G_mu}), highlights the effect of the suppliers' correlation in risk propagation. Namely, adding the $n$-th supplier reduces risk by a factor of 

\begin{equation}
  (1 - \mu) \ \frac{1}{1 + n \frac{\rho}{1 - \rho}}
\end{equation}

\begin{figure}[H]
  \centering
  \includegraphics[width = 0.7\linewidth]{../plots/risk-dumpening.png}
  \caption{Risk dumbening factor $\frac{1}{1 + n \frac{\rho}{1 - \rho}}$}
  \label{fig:risk-dumpening}
\end{figure}

As correlation increases, the marginal reduction in risk the firm can expect from adding a supplier decreases (Figure \ref{fig:risk-dumpening}). This expansion also shows how this dynamical system can be seen as a generalisation of the simpler dynamical system where there is no correlation in the supplier risk, such that

\begin{equation}
  \lim_{\rho \rightarrow 0} G_\mu(\mu, \rho, s) = \mu^s.
\end{equation}

Similarly, for sufficiently large $m$, we can derive an analytical expression for the evolution of overdisperion. Letting $\mu' = G_\mu(\mu, \rho, s)$, then

\begin{equation}
  G_\rho(\mu, \rho, s) = \frac{\left( \mu \  \frac{1 - \rho}{\rho} + s \right)^{(s)} \Big/ \left( \frac{1 - \rho}{\rho} + s \right)^{(s)} - \mu'}{1 - \mu'} = \frac{\prod^{s - 1}_{n = 0} \frac{\mu + (n + s) \frac{\rho}{1 - \rho}}{1 + (n + s) \frac{\rho}{1 - \rho}} - \mu'}{1 - \mu'}
\end{equation}



Again, without suppliers' correlation, the dynamical system converges to the simpler binomial case,

\begin{equation}
  \lim_{\rho \rightarrow 0} G_\rho(\mu, \rho, s) = 0.
\end{equation}

Another intuitive property of the dynamical system is that the risk and correlation are constant throughout the layers only if the choice of suppliers is $s = 1$. 

\begin{lemma}
  In $(\mu, \rho) \in (0, 1)^2$, if $s = 1$, every point is a fixed point \begin{equation}
    (\mu, \rho) = G(\mu, \rho, 1). 
  \end{equation}
\end{lemma}

\begin{lemma}
  If $s \neq 1$, the only fixed points are the points $(\mu, \rho)$ equal to $(0, 0)$  or $(0, 1)$.
\end{lemma}

\subsubsection{Agent's Choice}

The representative agent in layer $k + 1$ choses the number of suppliers to maximise

\begin{equation}
  s_{k + 1}(\mu_k, \rho_k) = \max_{s \in \mathbb{N}_0} \Pi(s) =\max_{s \in \mathbb{N}_0} \left\{ \pi \Big(1 - G_{\mu}(\mu_k, \rho_k, s)\Big) - \kappa \  s \right\}.
\end{equation}

The function $\Pi(s)$ is strictly concave over $\Re$\footnote{
  Since, for $x > 0$, $\text{sign}(\psi_{n + 1}(x)) = (-1)^{n + 1}$, implies $\text{sign}\big(\psi_n(x + \varepsilon) - \psi_n(x) \big) = (-1)^n$, we have $\Pi''(s) < 0$.
}. This simplifies greatly the optimisation problem over $\mathbb{N}_0$. In particular, let $\tilde{s}$ be the maximizer over the real numbers $\tilde{s} \coloneqq \max_{s \in \mathbb{R}} \Pi(s)$, and $\bar{s}$ be such that $\Pi(\bar{s}) = \Pi(\bar{s} + 1)$\footnote{This is guaranteed to exist and be unique by strict concavity of $\Pi$.}. Then we know that the maximum over $\mathbb{N}_0$ will be distant at most $1$ from $\tilde{s}$ and contained between $\bar{s}$ and $\bar{s} + 1$. This allows us to identify it and study its properties starting from $\tilde{s}$.

\begin{figure}[H]
  \centering
  \includegraphics[width = 0.7\linewidth]{../plots/convex-integer-optimization.png}
  \caption{Relationship between $s_{k + 1}, \tilde{s}$, and $\bar{s}$. Plot with $\mu_k = 0.115$ and $\rho_k = 0.06$.}
  \label{fig:convex-integer-optimization}
\end{figure}

\subsubsection{A Special Case: No Correlation Risk}

\notes{I thought it would be good to analyse the one dimensional system first to build intuition.}

It is instructive to first consider the dynamics of risk in the case where there is no correlation among suppliers. That is, when the function $G$ converges to its familiar binomial counterpart,

\begin{equation}
   \lim_{\rho \rightarrow 0} \tilde{G}(\mu, \rho) = \begin{pmatrix} \mu^{\tilde{s}(\mu, 0)} \\ 0 \end{pmatrix}.
\end{equation}

Letting $\tilde{g}$ be the one dimensional mapping from $\mu_{k}$ to $\mu_{k + 1}$, it is easy to see that the first order condition implies\footnote{
  Things work out nicely
\begin{equation}
  \lim_{\rho \rightarrow 0} \frac{\partial G_\mu}{\partial s} = \lim_{\rho \rightarrow 0} G_\mu \times \left(\psi_0\left(s + \mu \frac{1 - \rho}{\rho} \right) - \psi_0\left(s + \frac{1 - \rho}{\rho} \right) \right) = \mu^{s} \log(\mu) = \frac{\partial \lim_{\rho \rightarrow 0} G_{\mu}}{\partial s}
\end{equation}
}

\begin{equation}
  \tilde{g}(\mu) \coloneqq \lim_{\rho \rightarrow 0}\tilde{G}_\mu(\mu, \rho) = -\frac{\kappa / \pi}{\log(\mu)}.
\end{equation}

The first interesting result of the system $\mu_{k + 1} = \tilde{g}(\mu_k)$ is that a fixed point $\bar{\mu}$ is stable if the ``value at risk'' is smaller than the marginal cost, namely $\mu \pi < \kappa$. Furthermore, the system exhibists a condition of criticality. 

\notes{How to say: a small shock to $\mu_0$ can bring the system from $\mu_{K} < 1$ to $\mu_K = 1$?}

\begin{figure}[H]
  \centering
  \includegraphics[width = 0.85\linewidth]{../plots/one-dim-bif.png}
  \caption{Bifurcation diagram of the limit system $\mu_{k + 1} = \tilde{G}_{\mu}(\mu_k, 0)$. The diagonal represents the stability condition.}
  \label{fig:one-dimensional-bifurcation}
\end{figure}

\subsubsection{Introducing correlation risk}

The first order condition gives us an implicit definition of $\tilde{s}$ 

\begin{equation}
  \begin{split}
    0 &= \frac{\kappa}{\pi} + \left. \frac{\partial G_\mu}{\partial s} \right\vert_{(\mu, \rho, \tilde{s})}  \\
    &= \frac{\kappa}{\pi \ G_\mu(\mu, \rho, \tilde{s})} + \psi_0\left(\tilde{s} + \mu \frac{1 - \rho}{\rho} \right) - \psi_0\left(\tilde{s} + \frac{1 - \rho}{\rho} \right)  
  \end{split}
\end{equation}

where $\psi_0$ is the digamma function. Remember that the states $(\bar{\mu}, \bar{\rho})$ for which the risk is constant are such that $\tilde{s}(\bar{\mu}, \bar{\rho})= 1$.

\begin{equation}
  \begin{split}
    \psi_0\left(\frac{1}{\textcolor{blue}{\bar{\rho}}} \right) - \psi_0\left(1 - \textcolor{red}{\bar{\mu}} + \frac{ \textcolor{red}{\bar{\mu}} }{\textcolor{blue}{\bar{\rho}}} \right) &= \frac{\kappa}{\pi \textcolor{red}{\bar{\mu}}}
  \end{split}
\end{equation}

which can be approximated, for small $\rho$, as

\begin{equation}
   - \textcolor{red}{\bar{\mu}}\log(\textcolor{red}{\bar{\mu}}) + \underbrace{\textcolor{blue}{\bar{\rho}} \ \left(\textcolor{red}{\bar{\mu}}^2 - \frac{1}{2}\textcolor{red}{\bar{\mu}} + \frac{1}{2}\right)}_{\text{local effect of overdispersion}} = \frac{\kappa}{\pi}.
\end{equation}

\begin{figure}[H]
  \centering
  \includegraphics[width = 0.85\linewidth]{../plots/agents.png}
  \caption{Contour plot of $\tilde{s}(\mu, \rho)$ and $\kappa / \pi = 1 / 8$. Highlighted the steady states $(\mu, \rho): \tilde{s}(\mu, \rho) = 1$.}
  \label{fig:agents-optimum}
\end{figure}

\begin{figure}[H]
  \centering
  \includegraphics[width = 0.85\linewidth]{../plots/basin_small.png}
  \caption{Basin of attraction of $\tilde{G}$ with $\kappa / \pi = 1 / 8$. The color of a point indicates the value $1 - \bar{\mu}$ of the attractor of that point.}
  \label{fig:basin-plot}
\end{figure}


\subsection{Social Planner}

The social planner problem consists in, on the one hand, minimising aggregate risk and, on the other, the number of edges. The risk faced by a firm depends only on how many firms in the first layer it is connected to, regardless of what path. Namely, if $n$ basal firms are involved in the firms' production, its risk is $1 - \mu^n$. Hence, a natural question is, if the social planner seeks to connect a firm to $n$ basal firms, what is the most edge parsimonious way to do so? 

\begin{definition}
  Let $\textit{min-max}(n)$ be the network where all firms in layer $1$ have $n$ suppliers and thereafter, each firm, is connect to only one supplier. 
\end{definition}

\begin{lemma}
  $\textit{min-max}(n)$ is the network with fewer edges that achieves $\mu^n$ risk.
\end{lemma}

\begin{proof}

To see this, consider Figure (\ref{fig:planner-n-target}). If the planner wants to achieve risk $\mu^n$ in layer $k$, any branching (right), vis-à-vis the min-max network (left), requires at a list one more edge to close the branching, hence it has as strictly more edges than the min-max network.

\end{proof}

\begin{figure}[H]
  \centering
  \begin{subfigure}{.5\textwidth}
    \centering
    \inputTikZ{0.5}{../diagrams/min-max-n.tikz} 
  \end{subfigure}%
  \begin{subfigure}{.5\textwidth}
    \centering
    \inputTikZ{0.5}{../diagrams/not-min-max-n.tikz} 
  \end{subfigure}%
  \caption{On the left the min-max$(n)$ network and on the right a deviation that achieves $\mu^n$.}
  \label{fig:planner-n-target}
\end{figure}

Furthermore, note that if a firm in layer $k$ is connected, the marginal benefit $\pi (1 - \mu^n)$ must be bigger than marginal costs $\kappa$, then it must be profitable to connect a firm in layer $k + 1$, since the marginal benefit would be the same. Now that we know that min-max$(n)$ is the optimal graph to achieve $\mu^n$, we can look for the optimum $\mu^n$. Particularly, the planner will pick the largest $n$ such that

\begin{equation}
  n < \frac{\log(\pi / \kappa) - \log(1 - \mu)}{\log(\mu)}.
\end{equation}

\newpage
\nocite{*}
% \printbibliography

\pagenumbering{gobble} % stop page numbering
\newpage
\appendix
\subfile{sections/appendix/appendix.tex}

\end{document}