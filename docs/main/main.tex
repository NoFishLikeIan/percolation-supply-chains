\documentclass[american, abstract=on]{scrartcl}

    \newcommand{\lang}{en}

    \usepackage{babel}
    \usepackage[utf8]{inputenc}

    \usepackage{csquotes}

    \usepackage{amsmath, amssymb, mathtools, bbm}
    \usepackage{amsthm}
    \usepackage{xcolor}
    \usepackage{xcolor-solarized}
    \usepackage{bm}

    \usepackage{graphicx}
    \usepackage{wrapfig}
    \usepackage{relsize}
    \usepackage{makecell}
    \usepackage{booktabs}
    \usepackage[font=footnotesize,labelfont=bf]{caption}
    \usepackage{subcaption}
    \usepackage{float}
    \usepackage{multirow} 
    \usepackage{hyperref}

    \usepackage{graphicx}
    \usepackage{wrapfig}
    \usepackage{relsize}
    \usepackage{makecell}
    \usepackage{booktabs}
    \usepackage[font=footnotesize,labelfont=bf]{caption}
    \usepackage{subcaption}
    \usepackage{float}
    \usepackage{multirow} 
    
    % Diagrams
    \iffalse
      \usepackage{tikz} 
      \usepackage{tikzit}
      \usetikzlibrary{positioning,fit,calc}
      \input{../diagrams/percolation.tikzstyles}
      \input{../diagrams/diagram.tikzstyles}

      \newcommand{\inputTikZ}[2]{%  
        \scalebox{#1}{\input{#2}}  
      }
    \fi
    
    % Refs
    \usepackage{hyperref}
    \usepackage{cleveref}
    \hypersetup{
        colorlinks = true, 
        urlcolor = blue,
        linkcolor = blue, 
        citecolor = blue 
      }      

    \usepackage{subfiles} % Load last

    % Theorems
    \theoremstyle{plain}
    \newtheorem{lemma}{Lemma}
    \newtheorem{definition}{Definition}
    \newtheorem{theorem}{Theorem}

    % Paths

    % Formatting
    \setlength{\parindent}{0em}
    \setlength{\parskip}{0.5em}
    \setlength{\fboxsep}{1em}
    \newcommand\headercell[1]{\smash[b]{\begin{tabular}[t]{@{}c@{}} #1 \end{tabular}}}

    % Graphs

    % Math commands

    \newcommand{\diff}{\text{d}}
    \renewcommand{\Re}{\mathbb{R}}
    \newcommand{\C}{\mathcal{C}}
    \newcommand{\F}{\mathcal{F}}
    \newcommand{\X}{\mathcal{X}}
    \newcommand{\G}{\mathcal{G}}
    \newcommand{\I}{\mathcal{I}}
    \newcommand{\N}{\mathcal{N}}
    \newcommand{\PF}{\mathcal{P} \F}

    \renewcommand{\P}{\mathbb{P}}
    \newcommand{\E}{\mathbb{E}}
    \newcommand{\V}{\mathbb{V}}

    \newcommand{\uI}[2][s]{\int^1_0 #2 \ \text{d} #1}
    \newcommand{\uH}[2][s]{\int^\frac{1}{2}_0 #2 \ \text{d} #1}
    \newcommand{\uF}[2][s]{\int^1_\frac{1}{2} #2 \ \text{d} #1}
    \newcommand{\norm}[1]{\left\lVert#1\right\rVert}
    \newcommand{\abs}[1]{\left\lvert#1\right\rvert}

    \newcommand{\Beta}{\text{Beta}}
    \newcommand{\Bin}{\text{Bin}}

    % Bibliography

    \usepackage[bibencoding=utf8, style=apa, backend=biber]{biblatex}
    \addbibresource{../supply-chain-reallocation.bib}

    \newcommand{\citein}[1]{\citeauthor{#1} (\citeyear{#1})}

    \newcommand\notes[1]{\textcolor{teal}{\textbf{#1}}}
    \newcommand\red[1]{\textcolor{red}{#1}}

    % Make title page

    \author{Andrea Titton}
    \title{Firms' Sourcing Decisions and\\ Production Network Fragility}
    
\begin{document}

\maketitle
\section{Introduction}

\section{Model}

In this section I will introduce a stylised production game of suppliers' risk diversification, in the spirit of the one developed by \citein{elliott_supply_2022}. The model, despite its simplicity, captures the interactions between firms’ decisions and suppliers’ correlation risks. I show how the correlation in suppliers’ risk, on top of directly introducing substantial tail risk, disincentivises firm risk diversification, even when the firms are risk neutral. Strikingly, the interaction between suppliers’ risk correlation and firms’ decision, can introduce fragility in a production network even if risk is kept constant.

\subsection{Setup}

Consider a vertical economy producing $K$ goods (as displayed in Figure \ref{fig:vertical-economy-diagram}). Each firm produces a single good and each good is produced by $m$ firms. The good produced in layer $k$ requires only the good produced in layer $k - 1$ as input. Each firm picks a set of suppliers in the previous layer to source from. Establishing a relation with a supplier has a fixed cost $\kappa$. If no firm, among its suppliers, is able to deliver the input good then the firm is not ``functional'' and hence not able to deliver downstream. I assume that being functional yields an exogenous payoff $\pi$. This assumption will be relaxed later by introducing market structure to endogenise $\pi$, but this does not change the main model mechanics. Finally, we assume that firms know the structure of the economy but do not observe the realised supplier relationship in upstream layers. The only source of risk in the model is a idiosyncratic probability $\mu$ that firms in layer $0$, which require no inputs, are not able to carry on production.

\begin{figure}[H]
  \centering
  % \inputTikZ{0.5}{../diagrams/model-presentation.tikz} 
  \includegraphics[width=0.5\textwidth]{example-image-a}
  \caption{$K$-layers vertical economy}
  \label{fig:vertical-economy-diagram}
\end{figure}

Letting $p_{k, i}$ be the probability of firm $i$ in layer $k$ being functional, the expected payoff for each firm is then

\begin{equation}
  \pi \times p_{k, i}(\text{suppliers of }i) - \kappa \times \text{number of suppliers of }i.
\end{equation}

\subsection{Social Planner Problem}


\subsection{Firm Problem}

At this stage it is useful to exploit the symmetry granted to us by firms not observing the sourcing of their potential suppliers. Hence, when faced with their supplier decision, it is sufficient for a firm to track the distribution of risk among suppliers and then pick the optimal number of sources at random. Furthermore, this choice will be identical for all firms producing a good, since they are ex-ante equal. Let $s_k$ be the number of suppliers picked by the repesentative firm in layer $k$ and $F_k$ be the distribution of functioning firms producing good $k$. Then, if a firm producing good $k + 1$ were to pick $s_{k + 1}$ suppliers among those producing $k$, the probability that not all of its suppliers are functional, $p_m : [m] \times [m] \to \mathbb{Q} \cap [0, 1]$, is

\begin{equation}
  p_m(s_{k + 1}, F_k) \coloneqq 1 - \overbrace{\binom{m - s_{k+1}}{F_k}}^{\substack{\text{sets of functioning firms such} \\ \text{that none are suppliers}}} \Bigg/ \underbrace{\binom{m}{F_k}}_{\substack{\text{all possible sets} \\ \text{of functioning firms}}}.
\end{equation}

\begin{definition} \label{definition:ptoF}
  If $p_k \sim \Beta(f_k, \rho_k)$ then $F_k \coloneqq \Bin\big(m, p_k \big)$ follows a $\Beta\Bin(m, f_k, \rho_k)$, with,

  \begin{equation} \label{eq:moments_of_F}
    \E \big[F_k\big] = m \E \big[p\big] = m f_k \text{ and } \V \big[F_k\big] = m f_k (1 - f_k) \big(1 + (m - 1) \ \rho_k\big)
  \end{equation}

  Notice that $F_k$ inherits its parameters from $p_k$.
\end{definition}

\begin{lemma} \label{lemma:Ftop}
  If $F_k \sim \Beta\Bin(m, f_k, \rho_k)$ then \begin{equation*}\lim_{m \rightarrow \infty} p_m(s_{k + 1}, F_k) \eqqcolon p_k \sim \Beta(f_{k + 1}, \rho_{k + 1})\end{equation*} for some $f_{k + 1}$ and $\rho_{k + 1}$.
\end{lemma}

The proof of this lemma {\color{red} is not done yet.} Lemma \ref*{lemma:Ftop} and Definition \ref*{definition:ptoF} combine into a powerful result: for large enough $m$ the number of firms that are able to operate at each stage of the production networks, $\{F_k\}$, follow the same distribution and are fully determined by the initial distribution, $F_0$, and the choices of suppliers in each layer, $\{s_k\}$. Furthermore, since the agent tries to maximise its expected payoff, we know that $F_{k - 1}$ will determine $s_k$. As illustrated in Figure \ref*{fig:propagation-of-risk}, this allows as to simply look at the evolution of the two parameters $f_k$ and $\rho_k$.


\begin{figure}[H]
  \centering
  % \inputTikZ{1}{../diagrams/probability-propagation.tikz} 
  \includegraphics[width=0.5\textwidth]{example-image-a}
  \caption{Diagram of the relation between $F_k$, $p_k$, and $F_{k - 1}$, for sufficiently large $m$.}
  \label{fig:propagation-of-risk}
\end{figure}

\subsubsection{Interpretation of the Parameters}

It is useful at this point to give an interpretation of $f$ and $\rho$, in the context of our model. Looking back at the relationship between the moments of $F_k$ and these parameters (Equation \ref{eq:moments_of_F}), we can see that $f_k$ is the mean probability of a firm functioning. A more subtle role is played by $\rho_k$. If $\rho_k = 0$, then there is no dispersion on the probability of failure and $F_k$ follows a binomial distribution. In this sense, we can use $\rho_k$ as a measure of suppliers' correlation in the system: if all firms have different suppliers, $\rho_k = 0$, the probability of failure is constant for all firms producing a given good, hence, the number of firms failing follows a binomial distrbution. Hereafter, I will refer to $f_k$ as \textit{functionality} {\color{red} (find a better name)} and $\rho_k$ as \textit{overdispersion}.

\subsubsection{Dynamics of Risk}

Let $G$ be the function mapping the functionality and overdispersion between layers. As we have argued above, the downstream functionality and overdispersion depend only on the current one and supplier choices,

\begin{equation}
  (f_{k + 1}, \rho_{k + 1}) = G(f_k, \rho_k, s_{k + 1}).
\end{equation}

For large $m$, this mapping has an analytical form,

\begin{equation}
  f_{k + 1} = G_f(f_k, \rho_k, s_{k + 1}) \coloneqq 1 - \frac{B\Big( (1 - f_k) \frac{1 - \rho_k}{\rho_k} + s, f \frac{1 - \rho}{\rho} \Big)}{B\Big( (1 - f_k) \frac{1 - \rho_k}{\rho_k}, f_k \frac{1 - \rho_k}{\rho_k} \Big)}
\end{equation}

and

\begin{equation}
  \rho_{k + 1} = G_\rho(f_k, \rho_k, s_{k + 1}) \coloneqq \frac{ B\left(\frac{1 - \rho_k}{\rho_k}, 2s_{k + 1} \right) \Big/ B\left((1 - f) \frac{1 - \rho_k}{\rho_k}, 2s_{k + 1} \right)}{f_{k + 1} (1 - f_{k + 1})} - \frac{1 - f_{k + 1}}{f_{k + 1}}.
\end{equation}

where $B$ is the beta function. Despite looking complicated, the function $G$ simply attempts to account for the evolution of tail risk arising from suppliers correlation. As correlation disappears, the function $G$ converges to its binomial counterpart, namely

\begin{equation}
  \lim_{\rho_k \rightarrow 0} G(f_k, \rho_k, s_{k + 1}) = \begin{pmatrix}
    1 - (1 - f_k)^{s_{k + 1}} \\ 0
  \end{pmatrix}.
\end{equation}

Furthermore, if in a layer each firm has only one supplier, as expected, the distribution remains constant, $(f, \rho) = G(f, \rho, 1)$ for all $f$ and $\rho$.

\begin{lemma}
  For $s \neq 0$, $(f, \rho) \mapsto G(f, \rho, s)$ has no fixed point in $(0, 1)^2$.
\end{lemma}

\subsubsection{Agent's Choice}

The representative agent in layer $k + 1$ choses the number of suppliers $s_{k+1}$ to maximise

\begin{equation}
  \pi \underbrace{G_f(f_k, \rho_k, s_{k + 1})}_{f_{k + 1}} - \kappa \  s_{k + 1}.
\end{equation}

It is instructive to solve the problem for a continuous $s_{k+1}$. Let $\tilde{s}_{k + 1}(f_k, \rho_k)$ be the maximiser over $\Re$ and $\tilde{G}(f_k, \rho_k) \coloneqq G\big(f_k, \rho_k,  \tilde{s}_{k + 1}(f_k, \rho_k)\big)$.

\newpage
\nocite{*}
\printbibliography

\pagenumbering{gobble} % stop page numbering
\newpage
\appendix
\subfile{sections/appendix/appendix.tex}
\end{document}